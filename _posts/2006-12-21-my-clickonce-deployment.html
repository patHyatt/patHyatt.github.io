---
layout: post
title: My ClickOnce Deployment
date: '2006-12-21T12:48:00.000-05:00'
author: Pat Hyatt
tags:
- ClickOnce
modified_time: '2006-12-21T13:06:38.636-05:00'
blogger_id: tag:blogger.com,1999:blog-1130780247100205939.post-7565781598168859274
blogger_orig_url: http://patpack.blogspot.com/2006/12/my-clickonce-deployment.html
---

<span style=";font-family:arial;font-size:100%;"  >ClickOnce, Microsofts new deployment mechanism, introduced in .Net framework 2.0 is just neat. Given a directive to make an application ClickOnce deployable I had to devise a way. Let me explain....<br /><br />ClickOnce is primarily designed to have a development shop post their binaries to a web server and deployed to a clients box from that server. My charter was to make this application installable to a clients box, and hosted from that such that all clients would ping that box for installs and updates. This posed a problem due to the signing required for ClickOnce manifests and the application requiring configuration when it installed on that server computer.<br /><br />My resolution was to have a standard MSI based installation which copied all of the required files for the application to the server machine, then using a bat file which called mage.exe generate and sign the manifests.<br /><br />My bat file:<br /></span><br /><span style=";font-family:arial;font-size:9px;"  >@echo off<br /><br />if(%1) == "" goto error<br />if(%2) == "" goto error<br />if(%3) == "" goto error<br />if(%4) == "" goto error<br />if(%6) == "" goto error<br />if(%7) == "" goto error<br />if(%8) == "" goto error<br /><br />echo ***Manifest Signing Application***<br /><br />chdir %7<br />set var=%3<br />set var=%var:"=%<br /><br />set product=%1<br />SET product=###%product%###<br />SET product=%product:"###=%<br />SET product=%product:###"=%<br />SET product=%product:###=%<br /><br />set mfPath="%var%%product%.exe.manifest"<br />set appPath="%var%%product%.application"<br />set frmDir=%var:~0,-1%<br />if exist %mfPath% del /F %mfPath%<br />if exist %appPath% del /F %appPath%<br /><br />mage.exe -New Application -ToFile %mfPath% -Name "%product%" -Version %2 -FromDirectory "%frmDir%"<br /><br />cscript insert.vbs %mfPath% app.ico<br /><br />if "%~5" == "" goto NoPassword<br /><br />mage.exe -Sign %mfPath% -CertFile %4 -password %5<br />goto continue<br /><br />:NoPassword<br />mage.exe -Sign %mfPath% -CertFile %4<br /><br />:continue<br /><br />mage.exe -New Deployment -ToFile %appPath% -Name "%product%" -Version %2 -AppManifest %mfPath% -providerUrl %6 -Install true<br /><br />set desc="<description publisher="%8%" product="%product%%" set="" desc="%desc%" xmlns="urn:schemas-microsoft-com:asm.v1">"<br />cscript replace.vbs %appPath% "<description publisher="" desc="" if="" password="" 5="" goto="" nopasswordapp="" exe="" sign="" apppath="" certfile="" done="" del="" 4="" exit="" 0="" an="" error="" has="" occured="" please="" ensure="" all="" parameters="" have="" values="" echo="" useage="" bat=""><productname> <version> <directory> <certfile> <certpw> <deployurl> <magedir> <publisher>"<br /><br />exit 1</publisher></magedir></deployurl></certpw></certfile></directory></version></productname></description></description></span><span style=";font-family:arial;font-size:100%;"  ><br /></span><span style="font-size:100%;"><br /><br /><span style="font-family:arial;">Has this been problematic? Absolutely, mainly due to configuration of the app.config file after the app has been installed. This is more of an overlook as the System.Deployment along with the System.Configuration namespaces allow for modification of the app.config file during runtime. </span></span>